# 自動起動時の問題分析

## 問題の本質

### 手動起動（正常）
1. デスクトップからターミナルを開く
2. コードフォルダに移動
3. 仮想環境に入る
4. `bash start_pi.sh`を実行
5. **→ カードリーダーが認識されて正常動作**

### 自動起動（問題）
1. systemdサービスが起動
2. `start_pi.sh`を実行
3. **→ カードリーダーが認識されない**
4. `pi_client.py`の`run()`メソッドでリーダーが見つからない
5. `return`で終了
6. **→ しかし`Restart=always`なので再起動**
7. **→ 無限ループで再起動を繰り返す**

## 現在のコードの問題

### `pi_client.py`の`run()`メソッド（1182-1191行目）

```python
# リーダーが見つからない場合
if nfcpy_count == 0 and pcsc_count == 0:
    print("[エラー] カードリーダーが見つかりません")
    print("[ヒント] リーダーを接続してプログラムを再起動してください")
    if self.lcd:
        self.lcd.show_with_time("No Reader")
    self.gpio.led("red")
    return  # ← ここで終了
```

**問題点:**
- リーダーが見つからない場合、すぐに`return`で終了
- しかし`Restart=always`なので、すぐに再起動される
- リーダーが認識されるまで待機する仕組みがない
- 無限ループで再起動を繰り返す

## 解決策

1. **リーダーが見つからない場合、待機して再試行する**
2. **一定回数試行しても見つからない場合、長時間待機する**
3. **エラーログを適切に記録する**

