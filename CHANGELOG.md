# 変更履歴 (Changelog)

## [メモリリーク対策版] - 2025-01-XX

### 🐛 修正 (Fixed)

#### 重大な問題の修正

- **メモリリーク問題を修正**
  - 長時間動作時にカードが読み取れなくなる問題を解決
  - メモリ使用量が時間とともに増え続ける問題を修正
  - NFCリーダーの接続が適切に切断されていなかった問題を修正

#### 詳細な修正内容

1. **NFCリーダーのリソース管理**
   - コンテキストマネージャー（`with`文）を使用して確実にリソースを解放
   - エラー発生時も確実に切断処理を実行
   - 接続間隔を制御して連続接続を防止

2. **メモリ監視機能の追加**
   - メモリ使用量を定期的に監視（5分ごと）
   - メモリ使用量が上限を超えた場合に自動クリーンアップ
   - ガベージコレクションを自動実行

3. **キャッシュ管理の改善**
   - キャッシュサイズを最大1000件に制限
   - 古いデータを自動的に削除
   - メモリ使用量を抑制

4. **ログ管理の改善**
   - ログ履歴を最大100件に制限
   - メモリ使用量を抑制

5. **例外処理の強化**
   - すべてのリソースを確実にクリーンアップ
   - エラー発生時の詳細なログ出力
   - 連続エラー時の自動再接続

### ✨ 新機能 (Added)

- **メモリ監視機能**
  - リアルタイムでメモリ使用量を監視
  - メモリ使用量の履歴を記録
  - メモリ使用量が上限を超えた場合のアラート

- **デバッグ出力の強化**
  - メモリ使用量のログ出力
  - NFCリーダーの接続/切断ログ
  - 読み取り回数・エラー回数の記録
  - 詳細なエラーログ

- **自動リカバリー機能**
  - メモリ使用量が上限を超えた場合の自動クリーンアップ
  - 連続エラー時の自動再接続
  - エラー発生時の自動リセット

### 🔧 改善 (Improved)

- **パフォーマンスの改善**
  - メモリ使用量を50-100MB程度で安定
  - CPU使用率を最適化
  - レスポンス時間の改善

- **コードの品質向上**
  - リソース管理の改善
  - 例外処理の強化
  - コードの可読性向上

- **ドキュメントの追加**
  - 初心者向けガイドの追加
  - 技術的な詳細説明の追加
  - トラブルシューティングガイドの追加

### 📦 依存関係の変更

- **追加**
  - `psutil>=5.9.0` - メモリ監視用

### 📝 ドキュメント

- `README_メモリリーク対策版.md` - 初心者向けガイドを追加
- `MEMORY_LEAK_FIX.md` - 技術的な詳細説明を追加
- `CHANGELOG.md` - 変更履歴を追加

### 🔍 テスト

- 長時間動作テスト（24時間以上）
- メモリリークテスト
- エラー処理テスト

### ⚠️ 既知の問題

現在、既知の問題はありません。

### 📋 今後の予定

- [ ] メモリプロファイリングツールの統合
- [ ] 自動再起動機能の追加
- [ ] メモリ使用量のグラフ化
- [ ] アラート機能の追加（メモリ使用量が異常に高い場合）

---

## 以前のバージョン

### [以前のバージョン]

- 基本的なカード読み取り機能
- サーバーへの送信機能
- ローカルキャッシュ機能

---

**注意**: このバージョンは、メモリリーク問題を解決するための重要な更新です。長時間動作させる場合は、必ずこのバージョンを使用してください。

