# ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆã‚¬ã‚¤ãƒ‰ ğŸš€

**åˆå¿ƒè€…ã§ã‚‚5ã‚¹ãƒ†ãƒƒãƒ—ã§èµ·å‹•ã§ãã¾ã™ï¼**

---

## å¿…è¦ãªã‚‚ã®

- Raspberry Piï¼ˆ3ä»¥ä¸Šæ¨å¥¨ï¼‰
- ã‚«ãƒ¼ãƒ‰ãƒªãƒ¼ãƒ€ãƒ¼ï¼ˆSony RC-S380/S ãªã©ï¼‰
- LCDãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
- ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæ¥ç¶š

---

## ã‚¹ãƒ†ãƒƒãƒ—1ï¼šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰

### æ–¹æ³•Aï¼šGitã‚’ä½¿ã†å ´åˆ

```bash
cd ~/Desktop
git clone https://github.com/opticalbreeze/card_reader_improved.git
cd card_reader_improved
```

### æ–¹æ³•Bï¼šZIPã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹å ´åˆ

1. GitHubã®ãƒšãƒ¼ã‚¸ã‹ã‚‰ã€ŒCodeã€â†’ã€ŒDownload ZIPã€ã‚’ã‚¯ãƒªãƒƒã‚¯
2. ZIPãƒ•ã‚¡ã‚¤ãƒ«ã‚’Raspberry Piã«è»¢é€
3. è§£å‡ã—ã¦ç§»å‹•

```bash
cd ~/Desktop
unzip card_reader_improved-main.zip
cd card_reader_improved-main
```

---

## ã‚¹ãƒ†ãƒƒãƒ—2ï¼šè‡ªå‹•ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚’å®Ÿè¡Œ

**ã“ã®ã‚³ãƒãƒ³ãƒ‰1ã¤ã§å…¨ã¦è‡ªå‹•ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¾ã™ï¼**

```bash
chmod +x setup.sh
./setup.sh
```

**æ‰€è¦æ™‚é–“ï¼šç´„5-10åˆ†**

ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—å†…å®¹ï¼š
- âœ“ å¿…è¦ãªã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
- âœ“ ã‚«ãƒ¼ãƒ‰ãƒªãƒ¼ãƒ€ãƒ¼ã®æ¨©é™è¨­å®š
- âœ“ PC/SCã‚µãƒ¼ãƒ“ã‚¹ã®è¨­å®š
- âœ“ I2Cã®æœ‰åŠ¹åŒ–

**å®Œäº†ã—ãŸã‚‰å†èµ·å‹•ã—ã¦ãã ã•ã„ï¼š**

```bash
sudo reboot
```

---

## ã‚¹ãƒ†ãƒƒãƒ—3ï¼šã‚·ã‚¹ãƒ†ãƒ è¨ºæ–­ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ã ãŒæ¨å¥¨ï¼‰

å†èµ·å‹•å¾Œã€ã‚·ã‚¹ãƒ†ãƒ ãŒæ­£å¸¸ã‹ç¢ºèªï¼š

```bash
cd ~/Desktop/card_reader_improved-main
python3 check_system.py
```

**å…¨ã¦ âœ“ OK ã«ãªã‚Œã°OKï¼**

å•é¡ŒãŒã‚ã‚‹å ´åˆã€ç”»é¢ã«è§£æ±ºæ–¹æ³•ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

---

## ã‚¹ãƒ†ãƒƒãƒ—4ï¼šè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†

ã‚µãƒ¼ãƒãƒ¼ã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’è¨­å®šã—ã¾ã™ï¼š

```bash
nano client_config.json
```

ç·¨é›†å†…å®¹ï¼š

```json
{
  "server_url": "http://192.168.11.24:5000",
  "lcd_backlight": true
}
```

- `server_url`: ã‚µãƒ¼ãƒãƒ¼ã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ãƒãƒ¼ãƒˆ
- `lcd_backlight`: LCDã®æ˜ã‚‹ã•ï¼ˆ`true`=æ˜ã‚‹ã„ã€`false`=æš—ã„ï¼‰

**ä¿å­˜æ–¹æ³•ï¼š** `Ctrl+O` â†’ `Enter` â†’ `Ctrl+X`

---

## ã‚¹ãƒ†ãƒƒãƒ—5ï¼šèµ·å‹•ï¼

**ç°¡å˜èµ·å‹•ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½¿ç”¨ï¼š**

```bash
./start_unified.sh
```

ã¾ãŸã¯ç›´æ¥å®Ÿè¡Œï¼š

```bash
source venv/bin/activate
python3 client_card_reader_unified_improved.py
```

---

## æ­£å¸¸èµ·å‹•æ™‚ã®è¡¨ç¤º

```
======================================================================
[ãƒ©ã‚ºãƒ‘ã‚¤çµ±åˆç‰ˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼ˆæ”¹å–„ç‰ˆï¼‰- LCD + GPIO + nfcpy/PC/SC]
======================================================================
ç«¯æœ«ID: DC:A6:32:9A:34:C8
ã‚µãƒ¼ãƒãƒ¼: http://192.168.11.24:5000
LCD: æœ‰åŠ¹
GPIO: ç„¡åŠ¹
nfcpy: åˆ©ç”¨å¯èƒ½
pyscard: åˆ©ç”¨å¯èƒ½

[æ¤œå‡º] nfcpyãƒªãƒ¼ãƒ€ãƒ¼ã‚’æ¤œç´¢ä¸­...
  - æ¤œå‡º: usb (SONY RC-S380/S on usb:001:006)

[æ¤œå‡º] nfcpy:1å° / PC/SC:0å°

[èµ·å‹•] nfcpyãƒªãƒ¼ãƒ€ãƒ¼#1 (usb) ã®ç›£è¦–ã‚’é–‹å§‹

[å¾…æ©Ÿ] ã‚«ãƒ¼ãƒ‰ã‚’ã‹ã–ã—ã¦ãã ã•ã„... (Ctrl+C ã§çµ‚äº†)
```

**ã‚«ãƒ¼ãƒ‰ã‚’ã‹ã–ã™ã¨èª­ã¿å–ã‚ŠãŒå§‹ã¾ã‚Šã¾ã™ï¼** ğŸ“‡

---

## ã‚ˆãã‚ã‚‹å•é¡Œã¨è§£æ±ºæ–¹æ³•

### å•é¡Œ1ï¼šã‚«ãƒ¼ãƒ‰ãƒªãƒ¼ãƒ€ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“

**åŸå› ï¼š** ã‚«ãƒ¼ãƒ‰ãƒªãƒ¼ãƒ€ãƒ¼ãŒæ¥ç¶šã•ã‚Œã¦ã„ãªã„ã€ã¾ãŸã¯æ¨©é™ãŒãªã„

**è§£æ±ºæ–¹æ³•ï¼š**
```bash
# USBãƒ‡ãƒã‚¤ã‚¹ç¢ºèª
lsusb

# å†ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
./setup.sh
sudo reboot
```

---

### å•é¡Œ2ï¼šLCDã«ä½•ã‚‚è¡¨ç¤ºã•ã‚Œãªã„

**åŸå› ï¼š** LCDæ¥ç¶šã‚¨ãƒ©ãƒ¼ã¾ãŸã¯ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆè¨­å®š

**è§£æ±ºæ–¹æ³•ï¼š**

1. **I2Cæ¥ç¶šç¢ºèª**
   ```bash
   i2cdetect -y 1
   ```
   `27`ã¾ãŸã¯`3f`ãŒè¡¨ç¤ºã•ã‚Œã‚Œã°OK

2. **ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆèª¿æ•´**
   - LCDãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«è£é¢ã®é’ã„ãƒã‚¸ã‚’å›ã™

3. **ãƒãƒƒã‚¯ãƒ©ã‚¤ãƒˆè¨­å®š**
   ```json
   {
     "lcd_backlight": false
   }
   ```

---

### å•é¡Œ3ï¼šã‚µãƒ¼ãƒãƒ¼ã«æ¥ç¶šã§ãã¾ã›ã‚“

**åŸå› ï¼š** ã‚µãƒ¼ãƒãƒ¼ãŒèµ·å‹•ã—ã¦ã„ãªã„ã€ã¾ãŸã¯URLé–“é•ã„

**è§£æ±ºæ–¹æ³•ï¼š**

1. **ã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•**
   ```bash
   cd server
   python3 server_improved.py
   ```

2. **ã‚µãƒ¼ãƒãƒ¼IPã‚¢ãƒ‰ãƒ¬ã‚¹ç¢ºèª**
   ```bash
   ip addr show
   ```

3. **è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ä¿®æ­£**
   ```bash
   nano client_config.json
   ```

---

### å•é¡Œ4ï¼šPC/SCã‚¨ãƒ©ãƒ¼

**ã‚¨ãƒ©ãƒ¼ï¼š** `Failed to establish context: Service not available`

**è§£æ±ºæ–¹æ³•ï¼š**
```bash
# PC/SCã‚µãƒ¼ãƒ“ã‚¹ã‚’èµ·å‹•
sudo systemctl start pcscd
sudo systemctl enable pcscd

# ç¢ºèª
pcsc_scan
```

---

## å›°ã£ãŸã¨ãã¯

### è¨ºæ–­ãƒ„ãƒ¼ãƒ«ã‚’å®Ÿè¡Œ

```bash
python3 check_system.py
```

ã™ã¹ã¦ã®å•é¡Œç‚¹ã¨è§£æ±ºæ–¹æ³•ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

### ãƒ­ã‚°ã‚’ç¢ºèª

```bash
# ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®å‡ºåŠ›ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜
python3 client_card_reader_unified_improved.py 2>&1 | tee log.txt
```

---

## åœæ­¢æ–¹æ³•

ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’åœæ­¢ã™ã‚‹ã«ã¯ï¼š**`Ctrl+C`**ã‚’æŠ¼ã™

---

## è‡ªå‹•èµ·å‹•è¨­å®šï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

Raspberry Pièµ·å‹•æ™‚ã«è‡ªå‹•ã§ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’èµ·å‹•ï¼š

```bash
# systemdã‚µãƒ¼ãƒ“ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
sudo nano /etc/systemd/system/card-reader.service
```

å†…å®¹ï¼š

```ini
[Unit]
Description=Card Reader System
After=network.target

[Service]
Type=simple
User=raspberry
WorkingDirectory=/home/raspberry/Desktop/card_reader_improved-main
ExecStart=/home/raspberry/Desktop/card_reader_improved-main/venv/bin/python3 client_card_reader_unified_improved.py
Restart=always

[Install]
WantedBy=multi-user.target
```

æœ‰åŠ¹åŒ–ï¼š

```bash
sudo systemctl enable card-reader
sudo systemctl start card-reader

# çŠ¶æ…‹ç¢ºèª
sudo systemctl status card-reader
```

---

## ã¾ã¨ã‚

**5ã‚¹ãƒ†ãƒƒãƒ—ã§å®Œäº†ï¼**

1. âœ… ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
2. âœ… `./setup.sh` ã‚’å®Ÿè¡Œ
3. âœ… å†èµ·å‹•
4. âœ… è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†
5. âœ… `./start_unified.sh` ã§èµ·å‹•

**ã“ã‚Œã ã‘ã§ã™ï¼** ğŸ‰

---

## ã‚µãƒãƒ¼ãƒˆ

å•é¡ŒãŒè§£æ±ºã—ãªã„å ´åˆï¼š

1. è¨ºæ–­ãƒ„ãƒ¼ãƒ«ã‚’å®Ÿè¡Œ: `python3 check_system.py`
2. ãƒ­ã‚°ã‚’ä¿å­˜: `python3 client_card_reader_unified_improved.py 2>&1 | tee log.txt`
3. GitHubã§Issueã‚’ä½œæˆã—ã¦ãƒ­ã‚°ã‚’æ·»ä»˜

---

**Happy Coding! ğŸ“‡âœ¨**

