# 自動起動時のカードリーダー認識問題の修正

## 問題の本質

### 手動起動（正常）
- デスクトップからターミナルを開く
- 仮想環境に入る
- `bash start_pi.sh`を実行
- **→ カードリーダーが認識されて正常動作**

### 自動起動（問題）
- systemdサービスが起動
- カードリーダーがまだ認識されていない状態で`pi_client.py`が実行される
- リーダーが見つからない → `return`で終了
- **→ `Restart=always` + `RestartSec=10`で10秒後に再起動**
- **→ 無限ループで再起動を繰り返す**

## 修正内容

### 1. `pi_client.py`の修正

**変更前:**
- リーダーが見つからない場合、すぐに`return`で終了

**変更後:**
- リーダーが見つからない場合、最大60秒間待機して再検出を試みる
- 30秒間隔で再検出
- それでも見つからない場合、5分待機してから終了（無限ループを防ぐ）

### 2. `attendance-client-fixed.service`の修正

**変更前:**
```ini
RestartSec=10
```

**変更後:**
```ini
RestartSec=300  # 5分（リーダーが見つからない場合の待機時間に合わせる）
```

## 動作フロー（修正後）

1. システム起動
2. サービスが起動
3. `start_pi.sh`を実行
4. `pi_client.py`を実行
5. リーダー検出を試みる
6. **見つからない場合:**
   - 30秒待機 → 再検出
   - 30秒待機 → 再検出（最大60秒）
   - それでも見つからない場合、5分待機して終了
   - サービスが5分後に再起動（`RestartSec=300`）
7. **見つかった場合:**
   - 正常に動作開始

## 期待される結果

- 自動起動時でも、リーダーが認識されるまで待機する
- 無限ループを防ぐ（5分待機してから終了）
- 適切なエラーメッセージとログを出力

